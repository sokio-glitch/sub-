name: Remote Build Skills for Termux

on:
  workflow_dispatch:

jobs:
  cross-compile:
    runs-on: ubuntu-latest
    # 添加权限声明，确保 Actions 有权操作
    permissions:
      contents: read
      
    steps:
      # 1. 直接使用 git 命令克隆（手动绕过 checkout 插件）
      - name: Manual Clone Source Code
        run: |
          git clone --depth 1 https://github.com/labiium/skills.git .
          # 顺便确认一下我们拿到了代码
          ls -R

      # 2. 配置 Rust 环境
      - name: Setup Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: aarch64-linux-android

      # 3. 安装工具（注意：ubuntu-latest 自带 NDK，通常在 /usr/local/lib/android/sdk/ndk-bundle）
      - name: Install Build Tools
        run: |
          cargo install cargo-ndk

      # 4. 执行交叉编译
      - name: Build with Cargo NDK
        run: |
          # 指定 API 21 以获得最大兼容性
          cargo ndk -t arm64-v8a -p 21 build --release

      # 5. 上传二进制产物
      - name: Upload Binary
        uses: actions/upload-artifact@v4
        with:
          name: skills-termux-bin
          path: target/aarch64-linux-android/release/skills
      - name: Upload Binary
        uses: actions/upload-artifact@v4
        with:
          name: skills-termux-bin
          path: target/aarch64-linux-android/release/skills
